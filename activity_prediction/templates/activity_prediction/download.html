<!doctype html>
<html>
  {% include 'header.html' %}

  <body class="no-nav" onload="makeDataTable('all')">
 
    <header>
      <h1>Download page</h1>
    </header>

    <main>

      {% if authenticated %}

      <div>
          <p>The download should begin shortly. If it doesn't, click
              <a data-auto-download href="/download/{{token}}">here</a>.</p>
        
          <br>
          <br>

          {% if summary %}
          <div>
            <h2>Result Summary</h2>
            {% for compound, compound_summary in summary.items %}
            <div>
              <h3>{{compound}}</h3>
              {% for result, df in compound_summary.items %}
                <div>
                  <p>
                    {{result}}
                  </p>
                  <table class="display table data" style="width:100%;text-align:center;">

                    <thead>
                      <tr>
                        {% for column in df %} 
                        <th>{{ column }}</th> 
                        {% endfor %} 
                      </tr>
                    </thead>
    
                    <tbody>
                      
                       {% for _, row in df.iterrows %}
                      <tr>
                        {% for data in row %}
                          <td>{{data}}</td>
                        {% endfor %}
                      </tr>
                       {% endfor %}
    
                    </tbody>
    
                  </table>
                </div>
              {% endfor %}
            </div>
            {% endfor%}
          </div>
          {% endif %}

          <form action="/">
              <input type="submit" value="Go to NPAIEngine home">
          </form> 
      </div>

      {% else %}
      <div>   
        <h2>Please log in to download file:</h2>
        {% if login_error %}
          <h3>Authetication error!</h3>
          {% endif %}
        <form action="/download/{{token}}" method="post">
          {% csrf_token %}
          <label for=username >Username:</label>
          <input type="text" id="username" 
              name="username">   
          <br >
          <label for=password>Password:</label>
          <input type="password" id="password" 
              name="password"> 
          <br>
          <br>
          <input type="submit" value="Login">
        </form> 
      </div>
      {% endif %}

    </main>

    <footer>

    </footer>

  </body>
</html>
